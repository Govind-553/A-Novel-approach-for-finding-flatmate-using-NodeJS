<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="icon" href="/img/profile.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Calistoga&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    body {
    margin: 0;
    padding: 0;
    width: 100%;
    background-image: url(/img/loginpage.jpg);
    background-size: 1536px 695px;
    background-size: cover;
    background-repeat: no-repeat;
}

.profile {
    text-align: left;
    margin: 20px 0 10px;
}

#profilePic {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    border: 4px solid snow;
    object-fit: cover;
}

.profile label {
    color: black;
    display: block;
    width: 20px;
    background-color: white;
    padding: 10px;
    border-radius: 20px;
    cursor: pointer;
    margin-top: -55px;
    margin-left: 165px;
    transform: translateX(-50%);
}

.profile input[type="file"] {
    display: none;
}

.profile-class {
    background-color: snow;
    font-family: 'Arial';
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    width: 800px;
    display: flex;
    height: auto;
    justify-content: space-between;
    position: relative;
    margin: 75px auto 0px;
    flex-wrap: wrap;
}

h1 {
    position: relative;
    top: 55px;
    left: -325px;
    text-align: center;
    color: black;
}

.profile-class label {
    display: block;
    margin-bottom: 5px;
    text-align: left;
}

.profile-class input, select {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    transition: border 0.3s ease, box-shadow 0.3s ease;
}

.profile-class input:focus, select:focus {
    border: 1px solid #f39c12;
    box-shadow: 0 0 8px rgba(243, 156, 18, 0.5);
}

.password-container {
    position: relative;
    width: 100%;
}

#togglePassword {
    position: absolute;
    top: 42%;
    right: -10px;
    transform: translateY(-50%);
    cursor: pointer;
    color: #D0B8A8;
}

.profile-button {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    margin-top: 20px;
}

.profile-button button {
    width: 100%;
    padding: 10px;
    border: none;
    background-color: #007bff;
    color: white;
    border-radius: 15px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.3s ease;
}

.profile-class button:hover {
    background-color: #0056b3;
    transform: scale(1.05);
}

.container-1, .container-2 {
    flex: 1;
    padding: 30px;
}

.container-2 {
    padding-left: 20px;
    padding-right: 20px;
}

@media (max-width: 1024px) {
    .profile-class {
        flex-direction: column;
        align-items: center;
    }
    .container-1, .container-2 {
        width: 100%;
    }
    .profile-button {
        flex-direction: column;
    }
    .profile-button button {
        width: 100%;
        margin-bottom: 10px;
    }
}

@media (max-width: 768px) {
    .profile-class {
        width: 95%;
        padding: 15px;
    }
}

@media (max-width: 480px) {
    .profile-class {
        width: 100%;
        padding: 10px;
    }
}
</style>
</head>
<body>
<h1>Edit Profile</h1>
<div class="profile-class">
    <div class="profile">
        <img src="{{profileImage}}" aria-label="Profile photo" id="profilePic" onerror="this.src='/img/User.png';">
        <label for="input-file" class="upload-label">
            <i class="fas fa-camera fa-lg"></i>
        </label>
        <input type="file" accept="image/jpeg, image/png, image/jpg" id="input-file" name="profilePic">
    </div>

    <div class="container-1">
        <form id="profileForm1">
            <div class="form-group">
                <label for="fullName">Full name:</label>
                <input type="text" id="fullName" name="fullName" placeholder="Enter full name" required disabled>
            </div>
            <div class="form-group">
                <label for="email">Email address:</label>
                <input type="email" placeholder="Enter your Email" id="email" name="email" required disabled>
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <div class="password-container">
                    <input type="password" id="password" name="password" placeholder="Enter Your Password" required disabled>
                    <i class="fas fa-eye" id="togglePassword"></i>
                </div>
            </div>
            <div class="form-group">
                <label for="address">Home Address:</label>
                <input type="text" placeholder="Enter your address" id="address" name="address" required disabled>
            </div>
            <div class="profile-button">
                <button type="button" id="editBtn">Edit</button>
            </div>
        </form>
    </div>

    <div class="container-2">
        <form id="profileForm2">
            <div class="form-group">
                <label for="contactNumber">Contact number:</label>
                <input type="tel" placeholder="Enter your contact number" id="contactNumber" name="contactNumber" required disabled>
            </div>
            <div class="form-group">
                <label for="Year">Select your Year:</label>
                <select id="Year" name="Year" required disabled>
                    <option value="FE">First Year (FE)</option>
                    <option value="SE">Second Year (SE)</option>
                    <option value="TE">Third Year (TE)</option>
                    <option value="BE">Fourth Year (BE)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Branch">Select your Branch:</label>
                <select id="Branch" name="Branch" required disabled>
                    <option value="CMPN">Computer Science</option>
                    <option value="INFT">Information Technology</option>
                    <option value="EXTC">Electronics & Telecommunication</option>
                    <option value="ELEC">Electrical</option>
                    <option value="ECS">Electronics & CS</option>
                </select>
            </div>
            <div class="form-group">
                <label for="AboutYourself">About Yourself:</label>
                <input type="text" placeholder="Describe about yourself" id="AboutYourself" name="AboutYourself" required disabled>
            </div>
            <div class="form-group">
                <label for="github">GitHub Profile:</label>
                <input type="url" placeholder="https://github.com/username" id="github" name="github" disabled>
            </div>
            <div class="form-group">
                <label for="linkedin">LinkedIn Profile:</label>
                <input type="url" placeholder="https://linkedin.com/in/username" id="linkedin" name="linkedin" disabled>
            </div>
            <div class="form-group">
                <label for="instagram">Instagram Profile:</label>
                <input type="url" placeholder="https://instagram.com/username" id="instagram" name="instagram" disabled>
            </div>
            <div class="form-group">
                <label for="portfolio">Portfolio/Website:</label>
                <input type="url" placeholder="https://yourportfolio.com" id="portfolio" name="portfolio" disabled>
            </div>
            
            <h2 style="text-align: center; margin-top: 30px; margin-bottom: 20px;">Preferences</h2>
            
            <div class="form-group">
                <label for="foodType">Preferred Food Type:</label>
                <select id="foodType" name="foodType" disabled>
                    <option value="" disabled selected>Select Food Type</option>
                    <option value="Veg">Veg</option>
                    <option value="Non-Veg">Non-Veg</option>
                    <option value="All → Veg, Non-Veg, Jain meal, Chinese">All → Veg, Non-Veg, Jain meal, Chinese</option>
                </select>
            </div>

            <div class="form-group">
                <label>Prefered Laundry nd Room Ameneties required:</label>
                <div class="checkbox-container" id="amenitiesContainer">
                    <!-- Laundry Options -->
                    <div class="checkbox-wrapper"><input type="checkbox" name="amenities" value="Wash & Iron" disabled><label>Wash & Iron</label></div>
                    <div class="checkbox-wrapper"><input type="checkbox" name="amenities" value="Dry Cleaning" disabled><label>Dry Cleaning</label></div>
                    <div class="checkbox-wrapper"><input type="checkbox" name="amenities" value="Pickup & Delivery Service" disabled><label>Pickup & Delivery Service</label></div>
                    <div class="checkbox-wrapper"><input type="checkbox" name="amenities" value="Subscription Plans" disabled><label>Subscription Plans</label></div>
                    <div class="checkbox-wrapper"><input type="checkbox" name="amenities" value="Express Service" disabled><label>Express Service</label></div>
                    
                    <!-- Room Options -->
                    <div class="checkbox-wrapper"><input type="checkbox" name="amenities" value="Furnished" disabled><label>Furnished</label></div>
                    <div class="checkbox-wrapper"><input type="checkbox" name="amenities" value="Parking" disabled><label>Parking</label></div>
                    <div class="checkbox-wrapper"><input type="checkbox" name="amenities" value="AC" disabled><label>AC</label></div>
                    <div class="checkbox-wrapper"><input type="checkbox" name="amenities" value="Non-AC" disabled><label>Non-AC</label></div>
                    <div class="checkbox-wrapper"><input type="checkbox" name="amenities" value="WiFi" disabled><label>WiFi</label></div>
                    <div class="checkbox-wrapper"><input type="checkbox" name="amenities" value="TV" disabled><label>TV</label></div>
                </div>
            </div>

            <div class="form-group">
                <label for="roomType">Preferred Room Type:</label>
                <select id="roomType" name="roomType" disabled>
                    <option value="" disabled selected>Select Room Type</option>
                     <option value="Single">Single</option>
                    <option value="Shared">Shared</option>
                    <option value="Apartment">Apartment</option>
                </select>
            </div>

            <div class="form-group">
                <label for="pricingValue">Pricing Preference:</label>
                <select id="pricingValue" name="pricingValue" disabled>
                    <option value="" disabled selected>Select Pricing</option>
                    <option value="Low: ₹5000 - 8000">Low: ₹5000 - 8000</option>
                    <option value="Medium: ₹8000 - 100000">Medium: ₹8000 - 100000</option>
                    <option value="High: ₹10000 - 15000">High: ₹10000 - 15000</option>
                </select>
            </div>

            <div class="form-group">
                 <label>Preferred Landmark:</label>
                 <div class="checkbox-container" id="landmarkContainer">
                    <div class="checkbox-wrapper"><input type="checkbox" name="landmark" value="Near Railway Station" disabled><label>Near Railway Station</label></div>
                    <div class="checkbox-wrapper"><input type="checkbox" name="landmark" value="Near Market" disabled><label>Near Market</label></div>
                    <div class="checkbox-wrapper"><input type="checkbox" name="landmark" value="Near Metro" disabled><label>Near Metro</label></div>
                    <div class="checkbox-wrapper"><input type="checkbox" name="landmark" value="Near College" disabled><label>Near College</label></div>
                    <div class="checkbox-wrapper"><input type="checkbox" name="landmark" value="Near Bus Station" disabled><label>Near Bus Station</label></div>
                 </div>
            </div>
            <div class="profile-button">
                <button type="button" id="saveBtn">Save Changes</button>
            </div>
        </form>
    </div>
</div>
<script>
        document.addEventListener('DOMContentLoaded', function() {
            const userData = JSON.parse('{{userData}}');
    
            document.getElementById('fullName').value = userData.fULL_name || '';
            document.getElementById('email').value = userData.email || '';
            document.getElementById('password').value = userData.password || '';
            document.getElementById('contactNumber').value = userData.contact_number || '';
            document.getElementById('address').value = userData.address || '';
            document.getElementById('Year').value = userData.year || '';
            document.getElementById('Branch').value = userData.branch || '';
            document.getElementById('AboutYourself').value = userData.about_yourself || '';
            document.getElementById('github').value = userData.github || '';
            document.getElementById('linkedin').value = userData.linkedin || '';
            document.getElementById('instagram').value = userData.instagram || '';
            document.getElementById('portfolio').value = userData.portfolio || '';
            document.getElementById('profilePic').value = userData.profile_pic || ''; 

            // Populate preferences
            document.getElementById('foodType').value = userData.food_type || '';
            document.getElementById('roomType').value = userData.room_type || '';
            document.getElementById('pricingValue').value = userData.pricing_value || '';
            
            // Populate checkboxes
            const amenities = userData.amenities ? userData.amenities.split(',') : [];
            document.querySelectorAll('input[name="amenities"]').forEach(cb => {
                cb.checked = amenities.includes(cb.value);
            });

            const landmarks = userData.landmark ? userData.landmark.split(',') : [];
            document.querySelectorAll('input[name="landmark"]').forEach(cb => {
                cb.checked = landmarks.includes(cb.value);
            });
        });

    document.addEventListener('DOMContentLoaded', function () {
    const editBtn = document.getElementById('editBtn');
    const saveBtn = document.getElementById('saveBtn');
    const profilePicInput = document.getElementById('input-file');
    const profileImageDisplay = document.getElementById('profilePic');
    const profileForm1 = document.getElementById('profileForm1');
    const profileForm2 = document.getElementById('profileForm2');


    // Enable editing
    editBtn.addEventListener('click', function () {
        // Enable all inputs and selects in both forms
        Array.from(profileForm1.elements).forEach((el) => el.disabled = false);
        Array.from(profileForm2.elements).forEach((el) => el.disabled = false);
        profilePicInput.disabled = false;
    });

    // Handle profile image upload
    profilePicInput.addEventListener('change', function () {
        if (profilePicInput.files.length > 0) {
            const formData = new FormData();
            formData.append('profileImage', profilePicInput.files[0]);

            fetch('/saveProfile', {
                method: 'POST',
                body: formData
            })
            .then((response) => response.text())
            .then((data) => {
                if (data === 'Profile updated successfully.') {
                    alert('Profile picture updated successfully!');
                    const imageUrl = URL.createObjectURL(profilePicInput.files[0]);
                    profileImageDisplay.src = imageUrl;
                } else {
                    alert('Failed to update profile picture.');
                }
            })
            .catch((error) => console.error(error));
        }
    });

    // Save other profile fields
    saveBtn.addEventListener('click', function () {
        const formData = new FormData();

        // Helper to append form data respecting checkboxes
        const appendFormData = (form) => {
            Array.from(form.elements).forEach((el) => {
                if (el.name) {
                    if (el.type === 'checkbox' || el.type === 'radio') {
                        if (el.checked) formData.append(el.name, el.value);
                    } else {
                        formData.append(el.name, el.value);
                    }
                }
            });
        };

        const profileForm1 = document.getElementById('profileForm1');
        if (profileForm1) appendFormData(profileForm1);

        const profileForm2 = document.getElementById('profileForm2');
        if (profileForm2) appendFormData(profileForm2);

        // Send the merged data
        fetch('/saveProfile', {
            method: 'POST',
            body: formData
        })
        .then((response) => response.text())
        .then((data) => {
            if (data === 'Profile updated successfully.') {
                alert('Profile updated successfully!');
                // Disable fields after saving
                document.querySelectorAll('input, select').forEach((el) => el.disabled = true);
                const profilePicInput = document.getElementById('input-file');
                if (profilePicInput) profilePicInput.disabled = true;
            } else {
                alert('Failed to update profile: ' + data);
            }
        })
        .catch((error) => console.error(error));
    });
});
// toggle password functionality
        const togglePassword = document.querySelector('#togglePassword');
        const passwordInput = document.querySelector('#password');

        togglePassword.addEventListener('click', () => {

            const type = passwordInput.type === 'password' ? 'text' : 'password';
            passwordInput.type = type;

            togglePassword.classList.toggle('fa-eye');
            togglePassword.classList.toggle('fa-eye-slash');
        });
</script>
</body>
</html> 